/*!
 * Copyright 2012, Chris Wanstrath
 * Released under the MIT License
 * https://github.com/defunkt/jquery-pjax
 */
(function(h){function l(G,H,I){I=t(H,I);return this.on("click.pjax",G,function(K){var J=I;if(!J.container){J=h.extend({},I);J.container=h(this).attr("data-pjax")}m(K,J)})}function m(M,H,J){J=t(H,J);var L=M.currentTarget;var I=h(L);if(L.tagName.toUpperCase()!=="A"){throw"$.fn.pjax or $.pjax.click requires an anchor element"}if(M.which>1||M.metaKey||M.ctrlKey||M.shiftKey||M.altKey){return}if(location.protocol!==L.protocol||location.hostname!==L.hostname){return}if(L.href.indexOf("#")>-1&&y(L)==y(location)){return}if(M.isDefaultPrevented()){return}var N={url:L.href,container:I.attr("data-pjax"),target:L};var K=h.extend({},N,J);var G=h.Event("pjax:click");I.trigger(G,[K]);if(!G.isDefaultPrevented()){B(K);M.preventDefault();I.trigger("pjax:clicked",[K])}}function s(K,G,I){I=t(G,I);var J=K.currentTarget;var H=h(J);if(J.tagName.toUpperCase()!=="FORM"){throw"$.pjax.submit requires a form element"}var L={type:(H.attr("method")||"GET").toUpperCase(),url:H.attr("action"),container:H.attr("data-pjax"),target:J};if(L.type!=="GET"&&window.FormData!==undefined){L.data=new FormData(J);L.processData=false;L.contentType=false}else{if(H.find(":file").length){return}L.data=H.serializeArray()}B(h.extend({},L,I));K.preventDefault()}function B(G){G=h.extend(true,{},h.ajaxSettings,B.defaults,G);if(h.isFunction(G.url)){G.url=G.url()}var K=r(G.url).hash;var M=h.type(G.container);if(M!=="string"){throw"expected string value for 'container' option; got "+M}var H=G.context=h(G.container);if(!H.length){throw"the container selector '"+G.container+"' did not match anything"}if(!G.data){G.data={}}if(h.isArray(G.data)){G.data.push({name:"_pjax",value:G.container})}else{G.data._pjax=G.container}function J(P,N,O){if(!O){O={}}O.relatedTarget=G.target;var Q=h.Event(P,O);H.trigger(Q,N);return !Q.isDefaultPrevented()}var I;G.beforeSend=function(P,O){if(O.type!=="GET"){O.timeout=0}P.setRequestHeader("X-PJAX","true");P.setRequestHeader("X-PJAX-Container",G.container);if(!J("pjax:beforeSend",[P,O])){return false}if(O.timeout>0){I=setTimeout(function(){if(J("pjax:timeout",[P,G])){P.abort("timeout")}},O.timeout);O.timeout=0}var N=r(O.url);if(K){N.hash=K}G.requestUrl=q(N)};G.complete=function(N,O){if(I){clearTimeout(I)}J("pjax:complete",[N,O,G]);J("pjax:end",[N,G])};G.error=function(Q,R,O){var N=x("",Q,G);var P=J("pjax:error",[Q,R,O,G]);if(G.type=="GET"&&R!=="abort"&&P){z(N.url)}};G.success=function(S,R,Z){var V=B.state;var Y=typeof h.pjax.defaults.version==="function"?h.pjax.defaults.version():h.pjax.defaults.version;var aa=Z.getResponseHeader("X-PJAX-Version");var P=x(S,Z,G);var O=r(P.url);if(K){O.hash=K;P.url=O.href}if(Y&&aa&&Y!==aa){z(P.url);return}if(!P.contents){z(P.url);return}B.state={id:G.id||n(),url:P.url,title:P.title,container:G.container,fragment:G.fragment,timeout:G.timeout};if(G.push||G.replace){window.history.replaceState(B.state,P.title,P.url)}var Q=h.contains(H,document.activeElement);if(Q){try{document.activeElement.blur()}catch(X){}}if(P.title){document.title=P.title}J("pjax:beforeReplace",[P.contents,G],{state:B.state,previousState:V});H.html(P.contents);var U=H.find("input[autofocus], textarea[autofocus]").last()[0];if(U&&document.activeElement!==U){U.focus()}a(P.scripts);var T=G.scrollTo;if(K){var N=decodeURIComponent(K.slice(1));var W=document.getElementById(N)||document.getElementsByName(N)[0];if(W){T=h(W).offset().top}}if(typeof T=="number"){h(window).scrollTop(T)}J("pjax:success",[S,R,Z,G])};if(!B.state){B.state={id:n(),url:window.location.href,title:document.title,container:G.container,fragment:G.fragment,timeout:G.timeout};window.history.replaceState(B.state,document.title)}E(B.xhr);B.options=G;var L=B.xhr=h.ajax(G);if(L.readyState>0){if(G.push&&!G.replace){k(B.state.id,[G.container,C(H)]);window.history.pushState(null,"",G.requestUrl)}J("pjax:start",[L,G]);J("pjax:send",[L,G])}return B.xhr}function w(G,H){var I={url:window.location.href,push:false,replace:true,scrollTo:false};return B(h.extend(I,t(G,H)))}function z(G){window.history.replaceState(null,"",B.state.url);window.location.replace(G)}var j=true;var F=window.location.href;var D=window.history.state;if(D&&D.container){B.state=D}if("state" in window.history){j=false}function c(I){if(!j){E(B.xhr)}var O=B.state;var H=I.state;var P;if(H&&H.container){if(j&&F==H.url){return}if(O){if(O.id===H.id){return}P=O.id<H.id?"forward":"back"}var G=f[H.id]||[];var N=G[0]||H.container;var J=h(N),L=G[1];if(J.length){if(O){u(P,O.id,[N,C(J)])}var M=h.Event("pjax:popstate",{state:H,direction:P});J.trigger(M);var Q={id:H.id,url:H.url,container:N,push:false,fragment:H.fragment,timeout:H.timeout,scrollTo:false};if(L){J.trigger("pjax:start",[null,Q]);B.state=H;if(H.title){document.title=H.title}var K=h.Event("pjax:beforeReplace",{state:H,previousState:O});J.trigger(K,[L,Q]);J.html(L);J.trigger("pjax:end",[null,Q])}else{B(Q)}J[0].offsetHeight}else{z(location.href)}}j=false}function e(H){var G=h.isFunction(H.url)?H.url():H.url,L=H.type?H.type.toUpperCase():"GET";var J=h("<form>",{method:L==="GET"?"GET":"POST",action:G,style:"display:none"});if(L!=="GET"&&L!=="POST"){J.append(h("<input>",{type:"hidden",name:"_method",value:L.toLowerCase()}))}var K=H.data;if(typeof K==="string"){h.each(K.split("&"),function(M,N){var O=N.split("=");J.append(h("<input>",{type:"hidden",name:O[0],value:O[1]}))})}else{if(h.isArray(K)){h.each(K,function(M,N){J.append(h("<input>",{type:"hidden",name:N.name,value:N.value}))})}else{if(typeof K==="object"){var I;for(I in K){J.append(h("<input>",{type:"hidden",name:I,value:K[I]}))}}}}h(document.body).append(J);J.submit()}function E(G){if(G&&G.readyState<4){G.onreadystatechange=h.noop;G.abort()}}function n(){return(new Date).getTime()}function C(H){var G=H.clone();G.find("script").each(function(){if(!this.src){h._data(this,"globalEval",false)}});return G.contents()}function q(G){G.search=G.search.replace(/([?&])(_pjax|_)=[^&]*/g,"").replace(/^&/,"");return G.href.replace(/\?($|#)/,"$1")}function r(H){var G=document.createElement("a");G.href=H;return G}function y(G){return G.href.replace(/#.*/,"")}function t(G,H){if(G&&H){H=h.extend({},H);H.container=G;return H}else{if(h.isPlainObject(G)){return G}else{return{container:G}}}}function o(H,G){return H.filter(G).add(H.find(G))}function v(G){return h.parseHTML(G,document,true)}function x(K,N,P){var J={},G=/<html/i.test(K);var H=N.getResponseHeader("X-PJAX-URL");J.url=H?q(r(H)):P.requestUrl;var L,I;if(G){I=h(v(K.match(/<body[^>]*>([\s\S.]*)<\/body>/i)[0]));var M=K.match(/<head[^>]*>([\s\S.]*)<\/head>/i);L=M!=null?h(v(M[0])):I}else{L=I=h(v(K))}if(I.length===0){return J}J.title=o(L,"title").last().text();if(P.fragment){var O=I;if(P.fragment!=="body"){O=o(O,P.fragment).first()}if(O.length){J.contents=P.fragment==="body"?O:O.contents();if(!J.title){J.title=O.attr("title")||O.data("title")}}}else{if(!G){J.contents=I}}if(J.contents){J.contents=J.contents.not(function(){return h(this).is("title")});J.contents.find("title").remove();J.scripts=o(J.contents,"script[src]").remove();J.contents=J.contents.not(J.scripts)}if(J.title){J.title=h.trim(J.title)}return J}function a(G){if(!G){return}var H=h("script[src]");G.each(function(){var K=this.src;var L=H.filter(function(){return this.src===K});if(L.length){return}var I=document.createElement("script");var J=h(this).attr("type");if(J){I.type=J}I.src=h(this).attr("src");document.head.appendChild(I)})}var f={};var g=[];var i=[];function k(H,G){f[H]=G;i.push(H);b(g,0);b(i,B.defaults.maxCacheLength)}function u(I,K,H){var J,G;f[K]=H;if(I==="forward"){J=i;G=g}else{J=g;G=i}J.push(K);K=G.pop();if(K){delete f[K]}b(J,B.defaults.maxCacheLength)}function b(G,H){while(G.length>H){delete f[G.shift()]}}function A(){return h("meta").filter(function(){var G=h(this).attr("http-equiv");return G&&G.toUpperCase()==="X-PJAX-VERSION"}).attr("content")}function p(){h.fn.pjax=l;h.pjax=B;h.pjax.enable=h.noop;h.pjax.disable=d;h.pjax.click=m;h.pjax.submit=s;h.pjax.reload=w;h.pjax.defaults={timeout:650,push:true,replace:false,type:"GET",dataType:"html",scrollTo:0,maxCacheLength:20,version:A};h(window).on("popstate.pjax",c)}function d(){h.fn.pjax=function(){return this};h.pjax=e;h.pjax.enable=p;h.pjax.disable=h.noop;h.pjax.click=h.noop;h.pjax.submit=h.noop;h.pjax.reload=function(){window.location.reload()};h(window).off("popstate.pjax",c)}if(h.event.props&&h.inArray("state",h.event.props)<0){h.event.props.push("state")}else{if(!("state" in h.Event.prototype)){h.event.addProp("state")}}h.support.pjax=window.history&&window.history.pushState&&window.history.replaceState&&!navigator.userAgent.match(/((iPod|iPhone|iPad).+\bOS\s+[1-4]\D|WebApps\/.+CFNetwork)/);if(h.support.pjax){p()}else{d()}})(jQuery);